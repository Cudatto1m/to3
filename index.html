<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện Tập Siêu Âm & X-quang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        /* Class tùy chỉnh để giữ tỷ lệ khung hình video/slide */
        .aspect-box {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* Tỷ lệ 16:9 */
        }
        .aspect-box iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0.75rem; /* rounded-xl */
        }
        .option-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .option-card:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .pop-in {
            animation: popIn 0.4s ease-out;
        }
        @keyframes popIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const quizData = [
            // Phần 1: 5 câu
            {
                part: 1,
                question: "Nguyên lý hoạt động của Siêu âm kiểu A (Amplitude) là gì?",
                options: [
                    "Đầu dò di chuyển liên tục tạo mặt cắt 2D.",
                    "Sóng phản xạ được ghi nhận và hiển thị dưới dạng các đỉnh nhọn (xung).",
                    "Sử dụng tia X để quét qua cơ thể.",
                    "Tạo ra hình ảnh 3D thời gian thực."
                ],
                correct: 1,
                explanation: "Siêu âm kiểu A ghi nhận sóng phản xạ dưới dạng xung điện và hiển thị thành các đỉnh nhọn trên biểu đồ."
            },
            {
                part: 1,
                question: "Trong biểu đồ siêu âm kiểu A, trục tung biểu diễn đại lượng nào?",
                options: [
                    "Thời gian (khoảng cách).",
                    "Tần số sóng âm.",
                    "Biên độ (cường độ) của sóng phản xạ.",
                    "Nhiệt độ mô."
                ],
                correct: 2,
                explanation: "Trục hoành là thời gian (khoảng cách), trục tung là biên độ (cường độ) sóng."
            },
            {
                part: 1,
                question: "Hình ảnh của Siêu âm kiểu B (Brightness) có đặc điểm gì?",
                options: [
                    "Biểu đồ dạng sóng xung.",
                    "Hình ảnh mặt cắt 2D xây dựng từ các chấm sáng.",
                    "Chỉ hiển thị xương màu trắng.",
                    "Là hình ảnh chụp cắt lớp vi tính."
                ],
                correct: 1,
                explanation: "Kiểu B tạo ra hình ảnh mặt cắt 2D từ các chấm sáng (pixel) có cường độ tỉ lệ với sóng phản xạ."
            },
            {
                part: 1,
                question: "Ứng dụng chính của Siêu âm kiểu A là gì?",
                options: [
                    "Đo chiều sâu các mô, độ dày giác mạc, định vị âm vang.",
                    "Xem hình thái thai nhi.",
                    "Kiểm tra dòng chảy của máu.",
                    "Tầm soát ung thư toàn thân."
                ],
                correct: 0,
                explanation: "Kiểu A có ưu điểm đo khoảng cách chính xác, dùng để đo độ dày giác mạc hoặc chiều sâu mô."
            },
            {
                part: 1,
                question: "Ưu điểm nổi bật giúp Siêu âm kiểu B trở thành kỹ thuật phổ biến nhất là gì?",
                options: [
                    "Chi phí cực rẻ.",
                    "Đo khoảng cách chính xác hơn kiểu A.",
                    "Cung cấp hình ảnh chi tiết, trực quan về giải phẫu và chức năng.",
                    "Sử dụng ít năng lượng hơn."
                ],
                correct: 2,
                explanation: "Kiểu B cho thấy rõ cấu trúc, hình thái và chuyển động (tim đập, thai nhi) nên rất trực quan."
            },
            // Phần 2: 5 câu
            {
                part: 2,
                question: "Tại sao siêu âm được coi là an toàn tuyệt đối cho thai nhi?",
                options: [
                    "Vì nó sử dụng năng lượng ánh sáng.",
                    "Vì nó sử dụng sóng âm tần số cao, không dùng bức xạ ion hóa.",
                    "Vì thời gian thực hiện rất nhanh.",
                    "Vì thai nhi có lớp bảo vệ tự nhiên."
                ],
                correct: 1,
                explanation: "Siêu âm dùng sóng âm >20kHz, không phải bức xạ ion hóa nên an toàn, không gây hại tế bào."
            },
            {
                part: 2,
                question: "Rủi ro chính của việc sử dụng X-quang đối với thai nhi là gì?",
                options: [
                    "Gây nóng cơ thể mẹ.",
                    "Làm thai nhi chuyển động nhiều.",
                    "Tổn thương DNA, nguy cơ dị tật bẩm sinh và ung thư.",
                    "Hình ảnh quá mờ không nhìn thấy gì."
                ],
                correct: 2,
                explanation: "X-quang dùng bức xạ ion hóa có thể gây tổn thương tế bào và biến đổi DNA."
            },
            {
                part: 2,
                question: "Tại sao hình ảnh thai nhi trên siêu âm lại rõ nét hơn X-quang?",
                options: [
                    "Do máy siêu âm hiện đại hơn.",
                    "Sóng âm phản xạ tốt với mô mềm và nước ối.",
                    "X-quang chỉ chụp được đen trắng.",
                    "Do thai nhi hấp thụ tia X hoàn toàn."
                ],
                correct: 1,
                explanation: "X-quang bị cản bởi xương và nước, trong khi siêu âm phản xạ tốt với mô mềm và dịch lỏng."
            },
            {
                part: 2,
                question: "Khả năng theo dõi sự phát triển của siêu âm có điểm gì vượt trội?",
                options: [
                    "Theo dõi thời gian thực, không giới hạn số lần.",
                    "Chỉ theo dõi được xương.",
                    "Cần phải tiêm thuốc cản quang.",
                    "Chỉ thực hiện được 1 lần duy nhất."
                ],
                correct: 0,
                explanation: "Siêu âm có thể làm thường xuyên, xem video thời gian thực (tim đập, cử động) mà không gây hại."
            },
            {
                part: 2,
                question: "Sóng siêu âm có tần số như thế nào?",
                options: [
                    "Thấp hơn 20Hz.",
                    "Từ 20Hz đến 20kHz.",
                    "Cao hơn 20kHz.",
                    "Bằng tần số sóng vô tuyến."
                ],
                correct: 2,
                explanation: "Siêu âm là âm thanh có tần số cao hơn ngưỡng nghe của con người (>20kHz)."
            }
        ];

        // Hệ thống âm thanh
        const playSound = (type) => {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.connect(gain);
                gain.connect(ctx.destination);

                if (type === 'correct') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(523.25, ctx.currentTime); 
                    osc.frequency.exponentialRampToValueAtTime(1046.5, ctx.currentTime + 0.1); 
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.5);
                } else {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, ctx.currentTime);
                    osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.2);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.2);
                }
            } catch (e) {
                console.error("Audio error:", e);
            }
        };

        const App = () => {
            // viewState: 'presentation' | 'intro' | 'quiz' | 'result'
            // Mặc định vào màn presentation trước
            const [viewState, setViewState] = useState('presentation');
            const [currentQ, setCurrentQ] = useState(0);
            const [score, setScore] = useState(0);
            
            const [wrongAnswers, setWrongAnswers] = useState([]); 
            const [isSolved, setIsSolved] = useState(false);
            const [shake, setShake] = useState(false);

            const handleStartQuiz = () => {
                setViewState('quiz');
                setCurrentQ(0);
                setScore(0);
                setWrongAnswers([]);
                setIsSolved(false);
            };

            const handleFinishPresentation = () => {
                setViewState('intro');
                window.scrollTo(0, 0);
            };

            const handleOptionClick = (index) => {
                if (isSolved) return; 
                if (wrongAnswers.includes(index)) return; 

                const currentQuestion = quizData[currentQ];
                
                if (index === currentQuestion.correct) {
                    setIsSolved(true);
                    playSound('correct');
                    if (wrongAnswers.length === 0) {
                        setScore(prev => prev + 1);
                    }
                } else {
                    setWrongAnswers(prev => [...prev, index]);
                    setShake(true);
                    playSound('wrong');
                    setTimeout(() => setShake(false), 400);
                }
            };

            const nextQuestion = () => {
                setWrongAnswers([]);
                setIsSolved(false);
                if (currentQ < quizData.length - 1) {
                    setCurrentQ(prev => prev + 1);
                } else {
                    setViewState('result');
                }
            };

            // --- VIEW 1: PRESENTATION (Slide Canva) ---
            if (viewState === 'presentation') {
                return (
                    <div className="flex items-center justify-center min-h-screen p-4">
                        {/* Container được căn chỉnh kích thước tối đa max-w-4xl để không quá rộng trên PC */}
                        <div className="glass-panel w-full max-w-4xl p-6 rounded-3xl pop-in flex flex-col relative">
                            <div className="flex justify-between items-center mb-4">
                                <h1 className="text-xl md:text-2xl font-bold text-gray-800 flex items-center">
                                    <i className="fas fa-chalkboard-teacher text-blue-600 mr-3"></i>
                                    Bài Giảng Lý Thuyết
                                </h1>
                            </div>

                            {/* Khung chứa Slide: Tự động giữ tỷ lệ 16:9 */}
                            <div className="w-full bg-gray-900 rounded-2xl overflow-hidden shadow-inner mb-10 aspect-box">
                                <iframe 
                                    loading="lazy"
                                    src="https://www.canva.com/design/DAG_DiO0iCI/SxZ3VOksqhuuvJYeIbaqJg/view?embed" 
                                    allowFullScreen="allowfullscreen" 
                                    allow="fullscreen"
                                ></iframe>
                            </div>

                            <div className="flex justify-between items-end mt-4">
                                <div className="text-sm text-gray-500 italic hidden md:block">
                                    <a href="https://www.canva.com/design/DAG_DiO0iCI/SxZ3VOksqhuuvJYeIbaqJg/view?utm_content=DAG_DiO0iCI&utm_campaign=designshare&utm_medium=embeds&utm_source=link" target="_blank" rel="noopener" className="hover:text-blue-600 underline">
                                        Mở tài liệu gốc
                                    </a>
                                </div>

                                {/* Nút chuyển tiếp dạng Floating nhưng nằm trong layout để dễ thấy */}
                                <button 
                                    onClick={handleFinishPresentation}
                                    className="ml-auto bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-xl font-bold shadow-lg transition-transform transform hover:scale-105 flex items-center"
                                >
                                    CÂU HỎI <i className="fas fa-arrow-right ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // --- VIEW 2: INTRO (Màn hình chào mừng) ---
            if (viewState === 'intro') {
                return (
                    <div className="flex items-center justify-center min-h-screen p-4">
                        <div className="glass-panel max-w-lg w-full p-8 rounded-3xl text-center pop-in relative">
                            <button 
                                onClick={() => setViewState('presentation')}
                                className="absolute top-4 left-4 text-gray-400 hover:text-gray-600 text-sm flex items-center transition-colors"
                            >
                                <i className="fas fa-chevron-left mr-1"></i> Slide
                            </button>

                            <div className="w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-6 flex items-center justify-center text-white text-3xl shadow-lg mt-4">
                                <i className="fas fa-user-md"></i>
                            </div>
                            <h1 className="text-3xl font-extrabold text-gray-800 mb-2">Sẵn sàng kiểm tra?</h1>
                            <p className="text-gray-600 mb-8">Chế độ luyện tập: Chọn sai được chọn lại</p>
                            
                            <div className="space-y-3 mb-8 text-left">
                                <div className="p-4 bg-white/50 rounded-xl border border-white shadow-sm flex items-center">
                                    <div className="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-3 font-bold">1</div>
                                    <div>
                                        <h3 className="font-bold text-gray-800 text-sm">Nguyên lý Siêu âm</h3>
                                        <p className="text-xs text-gray-500">Kiểu A & Kiểu B</p>
                                    </div>
                                </div>
                                <div className="p-4 bg-white/50 rounded-xl border border-white shadow-sm flex items-center">
                                    <div className="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-3 font-bold">2</div>
                                    <div>
                                        <h3 className="font-bold text-gray-800 text-sm">An toàn & So sánh</h3>
                                        <p className="text-xs text-gray-500">Siêu âm vs X-quang</p>
                                    </div>
                                </div>
                            </div>

                            <button 
                                onClick={handleStartQuiz}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl transition duration-300 shadow-xl transform hover:-translate-y-1"
                            >
                                Bắt Đầu Ngay
                            </button>
                        </div>
                    </div>
                );
            }

            // --- VIEW 3: RESULT ---
            if (viewState === 'result') {
                return (
                    <div className="flex items-center justify-center min-h-screen p-4">
                        <div className="glass-panel max-w-md w-full p-8 rounded-3xl text-center pop-in">
                            <div className="w-20 h-20 bg-yellow-400 rounded-full mx-auto mb-6 flex items-center justify-center text-white text-4xl shadow-lg">
                                <i className="fas fa-trophy"></i>
                            </div>
                            <h2 className="text-2xl font-bold text-gray-800 mb-2">Hoàn Thành!</h2>
                            <p className="text-gray-500 mb-6">Bạn đã trả lời đúng ngay lần đầu:</p>
                            
                            <div className="text-7xl font-black text-blue-600 mb-8 tracking-tight">{score}<span className="text-3xl text-gray-400 font-medium">/{quizData.length}</span></div>

                            <div className="space-y-3">
                                <button 
                                    onClick={handleStartQuiz}
                                    className="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-6 rounded-xl transition duration-300 shadow-lg"
                                >
                                    <i className="fas fa-redo-alt mr-2"></i> Làm Lại
                                </button>
                                <button 
                                    onClick={() => setViewState('presentation')}
                                    className="w-full bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 font-bold py-3 px-6 rounded-xl transition duration-300"
                                >
                                    Xem Lại Bài Giảng
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // --- VIEW 4: QUIZ (Câu hỏi) ---
            const question = quizData[currentQ];
            const isPart2 = question.part === 2;

            return (
                <div className="flex items-center justify-center min-h-screen p-4">
                    <div className={`glass-panel max-w-2xl w-full p-6 md:p-8 rounded-3xl relative overflow-hidden transition-all duration-300 ${shake ? 'shake' : ''}`}>
                        
                        {/* Header */}
                        <div className="flex justify-between items-center mb-6">
                            <div className="flex items-center">
                                <button 
                                    onClick={() => setViewState('intro')} 
                                    className="mr-3 text-gray-400 hover:text-gray-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors"
                                    title="Thoát"
                                >
                                    <i className="fas fa-times"></i>
                                </button>
                                <div className={`text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider ${isPart2 ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}`}>
                                    Phần {question.part}
                                </div>
                            </div>
                            
                            <div className="text-gray-500 font-bold text-sm bg-gray-100 px-3 py-1 rounded-lg">
                                {currentQ + 1} / {quizData.length}
                            </div>
                        </div>
                        
                        {/* Progress Bar */}
                        <div className="w-full bg-gray-100 rounded-full h-2 mb-8 overflow-hidden">
                            <div 
                                className={`h-full transition-all duration-500 ease-out ${isPart2 ? 'bg-green-500' : 'bg-blue-500'}`} 
                                style={{ width: `${((currentQ + 1) / quizData.length) * 100}%` }}
                            ></div>
                        </div>

                        {/* Question Text */}
                        <h2 className="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-relaxed">
                            {question.question}
                        </h2>

                        {/* Options List */}
                        <div className="space-y-3 mb-8">
                            {question.options.map((opt, index) => {
                                const isWrong = wrongAnswers.includes(index);
                                const isThisCorrect = index === question.correct;
                                
                                let stateClass = "bg-white border-gray-200 hover:border-blue-400 text-gray-700 hover:bg-blue-50";
                                let icon = null;

                                if (isWrong) {
                                    stateClass = "bg-red-50 border-red-500 text-red-500 font-medium cursor-not-allowed";
                                    icon = <i className="fas fa-times-circle text-red-500 text-xl"></i>;
                                }

                                if (isSolved && isThisCorrect) {
                                    stateClass = "bg-green-100 border-green-500 text-green-800 font-bold shadow-md transform scale-[1.02]";
                                    icon = <i className="fas fa-check-circle text-green-600 text-xl"></i>;
                                } else if (isSolved && !isThisCorrect && !isWrong) {
                                    stateClass = "bg-gray-50 border-gray-100 text-gray-300 opacity-50 cursor-default";
                                }

                                return (
                                    <button
                                        key={index}
                                        onClick={() => handleOptionClick(index)}
                                        disabled={isSolved || isWrong}
                                        className={`option-card w-full text-left p-4 rounded-xl border-2 flex justify-between items-center ${stateClass}`}
                                    >
                                        <span className="flex-1 text-base md:text-lg">{opt}</span>
                                        {icon && <span className="ml-3 animate-bounce-short">{icon}</span>}
                                    </button>
                                );
                            })}
                        </div>

                        {/* Feedback & Next Button */}
                        {isSolved && (
                            <div className="pop-in bg-green-50 border border-green-200 p-5 rounded-2xl mb-4 shadow-sm">
                                <div className="flex items-start mb-4">
                                    <div className="bg-green-200 rounded-full p-2 mr-3 mt-1">
                                        <i className="fas fa-lightbulb text-green-700"></i>
                                    </div>
                                    <div>
                                        <h4 className="font-bold text-green-800 mb-1">Giải thích</h4>
                                        <p className="text-green-800 text-sm leading-relaxed">{question.explanation}</p>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <button 
                                        onClick={nextQuestion}
                                        className="bg-gray-800 hover:bg-black text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-transform transform hover:-translate-y-1 flex items-center ml-auto"
                                    >
                                        {currentQ === quizData.length - 1 ? "Xem Kết Quả" : "Câu Tiếp Theo"} <i className="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {!isSolved && wrongAnswers.length > 0 && (
                            <div className="text-center text-red-500 text-sm font-semibold animate-pulse flex items-center justify-center">
                                <i className="fas fa-exclamation-circle mr-2"></i> Sai rồi! Hãy thử chọn đáp án khác.
                            </div>
                        )}

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

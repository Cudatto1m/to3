<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện Tập Siêu Âm & X-quang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        .option-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .option-card:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .pop-in {
            animation: popIn 0.4s ease-out;
        }
        @keyframes popIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Dữ liệu câu hỏi (Giữ nguyên nội dung cũ)
        const quizData = [
            // Phần 1: 5 câu
            {
                part: 1,
                question: "Nguyên lý hoạt động của Siêu âm kiểu A (Amplitude) là gì?",
                options: [
                    "Đầu dò di chuyển liên tục tạo mặt cắt 2D.",
                    "Sóng phản xạ được ghi nhận và hiển thị dưới dạng các đỉnh nhọn (xung).",
                    "Sử dụng tia X để quét qua cơ thể.",
                    "Tạo ra hình ảnh 3D thời gian thực."
                ],
                correct: 1,
                explanation: "Siêu âm kiểu A ghi nhận sóng phản xạ dưới dạng xung điện và hiển thị thành các đỉnh nhọn trên biểu đồ."
            },
            {
                part: 1,
                question: "Trong biểu đồ siêu âm kiểu A, trục tung biểu diễn đại lượng nào?",
                options: [
                    "Thời gian (khoảng cách).",
                    "Tần số sóng âm.",
                    "Biên độ (cường độ) của sóng phản xạ.",
                    "Nhiệt độ mô."
                ],
                correct: 2,
                explanation: "Trục hoành là thời gian (khoảng cách), trục tung là biên độ (cường độ) sóng."
            },
            {
                part: 1,
                question: "Hình ảnh của Siêu âm kiểu B (Brightness) có đặc điểm gì?",
                options: [
                    "Biểu đồ dạng sóng xung.",
                    "Hình ảnh mặt cắt 2D xây dựng từ các chấm sáng.",
                    "Chỉ hiển thị xương màu trắng.",
                    "Là hình ảnh chụp cắt lớp vi tính."
                ],
                correct: 1,
                explanation: "Kiểu B tạo ra hình ảnh mặt cắt 2D từ các chấm sáng (pixel) có cường độ tỉ lệ với sóng phản xạ."
            },
            {
                part: 1,
                question: "Ứng dụng chính của Siêu âm kiểu A là gì?",
                options: [
                    "Đo chiều sâu các mô, độ dày giác mạc, định vị âm vang.",
                    "Xem hình thái thai nhi.",
                    "Kiểm tra dòng chảy của máu.",
                    "Tầm soát ung thư toàn thân."
                ],
                correct: 0,
                explanation: "Kiểu A có ưu điểm đo khoảng cách chính xác, dùng để đo độ dày giác mạc hoặc chiều sâu mô."
            },
            {
                part: 1,
                question: "Ưu điểm nổi bật giúp Siêu âm kiểu B trở thành kỹ thuật phổ biến nhất là gì?",
                options: [
                    "Chi phí cực rẻ.",
                    "Đo khoảng cách chính xác hơn kiểu A.",
                    "Cung cấp hình ảnh chi tiết, trực quan về giải phẫu và chức năng.",
                    "Sử dụng ít năng lượng hơn."
                ],
                correct: 2,
                explanation: "Kiểu B cho thấy rõ cấu trúc, hình thái và chuyển động (tim đập, thai nhi) nên rất trực quan."
            },
            // Phần 2: 5 câu
            {
                part: 2,
                question: "Tại sao siêu âm được coi là an toàn tuyệt đối cho thai nhi?",
                options: [
                    "Vì nó sử dụng năng lượng ánh sáng.",
                    "Vì nó sử dụng sóng âm tần số cao, không dùng bức xạ ion hóa.",
                    "Vì thời gian thực hiện rất nhanh.",
                    "Vì thai nhi có lớp bảo vệ tự nhiên."
                ],
                correct: 1,
                explanation: "Siêu âm dùng sóng âm >20kHz, không phải bức xạ ion hóa nên an toàn, không gây hại tế bào."
            },
            {
                part: 2,
                question: "Rủi ro chính của việc sử dụng X-quang đối với thai nhi là gì?",
                options: [
                    "Gây nóng cơ thể mẹ.",
                    "Làm thai nhi chuyển động nhiều.",
                    "Tổn thương DNA, nguy cơ dị tật bẩm sinh và ung thư.",
                    "Hình ảnh quá mờ không nhìn thấy gì."
                ],
                correct: 2,
                explanation: "X-quang dùng bức xạ ion hóa có thể gây tổn thương tế bào và biến đổi DNA."
            },
            {
                part: 2,
                question: "Tại sao hình ảnh thai nhi trên siêu âm lại rõ nét hơn X-quang?",
                options: [
                    "Do máy siêu âm hiện đại hơn.",
                    "Sóng âm phản xạ tốt với mô mềm và nước ối.",
                    "X-quang chỉ chụp được đen trắng.",
                    "Do thai nhi hấp thụ tia X hoàn toàn."
                ],
                correct: 1,
                explanation: "X-quang bị cản bởi xương và nước, trong khi siêu âm phản xạ tốt với mô mềm và dịch lỏng."
            },
            {
                part: 2,
                question: "Khả năng theo dõi sự phát triển của siêu âm có điểm gì vượt trội?",
                options: [
                    "Theo dõi thời gian thực, không giới hạn số lần.",
                    "Chỉ theo dõi được xương.",
                    "Cần phải tiêm thuốc cản quang.",
                    "Chỉ thực hiện được 1 lần duy nhất."
                ],
                correct: 0,
                explanation: "Siêu âm có thể làm thường xuyên, xem video thời gian thực (tim đập, cử động) mà không gây hại."
            },
            {
                part: 2,
                question: "Sóng siêu âm có tần số như thế nào?",
                options: [
                    "Thấp hơn 20Hz.",
                    "Từ 20Hz đến 20kHz.",
                    "Cao hơn 20kHz.",
                    "Bằng tần số sóng vô tuyến."
                ],
                correct: 2,
                explanation: "Siêu âm là âm thanh có tần số cao hơn ngưỡng nghe của con người (>20kHz)."
            }
        ];

        // Audio System
        const playSound = (type) => {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.connect(gain);
                gain.connect(ctx.destination);

                if (type === 'correct') {
                    // Ting! (High pitch sine wave)
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(523.25, ctx.currentTime); 
                    osc.frequency.exponentialRampToValueAtTime(1046.5, ctx.currentTime + 0.1); 
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.5);
                } else {
                    // Buzz! (Low pitch sawtooth)
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, ctx.currentTime);
                    osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.2);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.2);
                }
            } catch (e) {
                console.error("Audio error:", e);
            }
        };

        const App = () => {
            const [started, setStarted] = useState(false);
            const [currentQ, setCurrentQ] = useState(0);
            const [score, setScore] = useState(0);
            const [showResult, setShowResult] = useState(false);
            
            // Logic mới:
            // wrongAnswers: Danh sách các index đã chọn sai ở câu hiện tại
            // isSolved: Câu hỏi này đã được chọn đúng chưa
            const [wrongAnswers, setWrongAnswers] = useState([]); 
            const [isSolved, setIsSolved] = useState(false);
            const [shake, setShake] = useState(false);

            const handleStart = () => {
                setStarted(true);
                setCurrentQ(0);
                setScore(0);
                setShowResult(false);
                setWrongAnswers([]);
                setIsSolved(false);
            };

            const handleOptionClick = (index) => {
                if (isSolved) return; // Nếu đã đúng rồi thì không cho bấm nữa
                if (wrongAnswers.includes(index)) return; // Nếu đã chọn sai ô này rồi thì không làm gì cả

                const currentQuestion = quizData[currentQ];
                
                if (index === currentQuestion.correct) {
                    // Chọn ĐÚNG
                    setIsSolved(true);
                    playSound('correct');
                    // Chỉ cộng điểm nếu chưa sai lần nào (First Try Correct)
                    if (wrongAnswers.length === 0) {
                        setScore(prev => prev + 1);
                    }
                } else {
                    // Chọn SAI
                    setWrongAnswers(prev => [...prev, index]); // Thêm vào danh sách sai để đổi màu
                    setShake(true);
                    playSound('wrong');
                    setTimeout(() => setShake(false), 400);
                }
            };

            const nextQuestion = () => {
                setWrongAnswers([]);
                setIsSolved(false);
                
                if (currentQ < quizData.length - 1) {
                    setCurrentQ(prev => prev + 1);
                } else {
                    setShowResult(true);
                }
            };

            if (!started) {
                return (
                    <div className="flex items-center justify-center min-h-screen p-4">
                        <div className="glass-panel max-w-lg w-full p-8 rounded-3xl text-center pop-in">
                            <div className="w-20 h-20 bg-blue-500 rounded-full mx-auto mb-6 flex items-center justify-center text-white text-3xl shadow-lg">
                                <i className="fas fa-stethoscope"></i>
                            </div>
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Trắc Nghiệm Y Khoa</h1>
                            <p className="text-gray-600 mb-8">Chế độ luyện tập: Sai được chọn lại</p>
                            
                            <button 
                                onClick={handleStart}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-xl transition duration-300 shadow-lg"
                            >
                                Bắt Đầu Luyện Tập
                            </button>
                        </div>
                    </div>
                );
            }

            if (showResult) {
                return (
                    <div className="flex items-center justify-center min-h-screen p-4">
                        <div className="glass-panel max-w-md w-full p-8 rounded-3xl text-center pop-in">
                            <h2 className="text-2xl font-bold text-gray-800 mb-6">Kết Quả Luyện Tập</h2>
                            
                            <div className="mb-8">
                                <div className="text-6xl font-black text-blue-600 mb-2">{score}/{quizData.length}</div>
                                <p className="text-gray-500">Số câu đúng ngay lần đầu</p>
                            </div>

                            <button 
                                onClick={handleStart}
                                className="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-6 rounded-xl transition duration-300"
                            >
                                Luyện Tập Lại
                            </button>
                        </div>
                    </div>
                );
            }

            const question = quizData[currentQ];
            const isPart2 = question.part === 2;

            return (
                <div className="flex items-center justify-center min-h-screen p-4">
                    <div className={`glass-panel max-w-2xl w-full p-6 md:p-8 rounded-3xl relative overflow-hidden transition-all duration-300 ${shake ? 'shake' : ''}`}>
                        
                        {/* Header */}
                        <div className="flex justify-between items-center mb-6">
                            <div className={`text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider ${isPart2 ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}`}>
                                Phần {question.part}
                            </div>
                            <div className="text-gray-500 font-semibold text-sm">
                                Câu {currentQ + 1} / {quizData.length}
                            </div>
                        </div>
                        
                        <div className="w-full bg-gray-200 rounded-full h-1.5 mb-8">
                            <div 
                                className={`h-1.5 rounded-full transition-all duration-500 ${isPart2 ? 'bg-green-500' : 'bg-blue-500'}`} 
                                style={{ width: `${((currentQ + 1) / quizData.length) * 100}%` }}
                            ></div>
                        </div>

                        {/* Question */}
                        <h2 className="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-relaxed">
                            {question.question}
                        </h2>

                        {/* Options */}
                        <div className="space-y-3 mb-8">
                            {question.options.map((opt, index) => {
                                const isWrong = wrongAnswers.includes(index);
                                const isThisCorrect = index === question.correct;
                                
                                let stateClass = "bg-white border-gray-200 hover:border-blue-400 text-gray-700";
                                let icon = null;

                                // Nếu ô này đã được chọn và nó sai
                                if (isWrong) {
                                    stateClass = "bg-red-50 border-red-500 text-red-500 font-medium";
                                    icon = <i className="fas fa-times-circle text-red-500 text-xl"></i>;
                                }

                                // Nếu câu hỏi đã giải xong, và đây là đáp án đúng
                                if (isSolved && isThisCorrect) {
                                    stateClass = "bg-green-100 border-green-500 text-green-800 font-bold shadow-md transform scale-105";
                                    icon = <i className="fas fa-check-circle text-green-600 text-xl"></i>;
                                } else if (isSolved && !isThisCorrect && !isWrong) {
                                    // Nếu đã giải xong, những câu chưa chọn sẽ mờ đi
                                    stateClass = "bg-gray-50 border-gray-100 text-gray-400 opacity-50";
                                }

                                return (
                                    <button
                                        key={index}
                                        onClick={() => handleOptionClick(index)}
                                        disabled={isSolved || isWrong} // Khóa nếu đã giải xong hoặc ô này đã biết là sai
                                        className={`option-card w-full text-left p-4 rounded-xl border-2 flex justify-between items-center ${stateClass}`}
                                    >
                                        <span className="flex-1">{opt}</span>
                                        {icon && <span className="ml-3">{icon}</span>}
                                    </button>
                                );
                            })}
                        </div>

                        {/* Feedback & Next Button - Chỉ hiện khi ĐÃ CHỌN ĐÚNG (isSolved = true) */}
                        {isSolved && (
                            <div className="pop-in bg-green-50 border border-green-200 p-5 rounded-2xl mb-4">
                                <div className="flex items-start mb-4">
                                    <i className="fas fa-lightbulb text-green-600 mt-1 mr-3"></i>
                                    <div>
                                        <h4 className="font-bold text-green-800 mb-1">Chính xác!</h4>
                                        <p className="text-green-700 text-sm">{question.explanation}</p>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <button 
                                        onClick={nextQuestion}
                                        className="bg-gray-800 hover:bg-black text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-transform transform hover:-translate-y-1"
                                    >
                                        {currentQ === quizData.length - 1 ? "Xem Kết Quả" : "Tiếp Tục"} <i className="fas fa-arrow-right ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {/* Nhắc nhở nếu chọn sai */}
                        {!isSolved && wrongAnswers.length > 0 && (
                            <div className="text-center text-red-500 text-sm font-semibold animate-pulse">
                                Sai rồi! Hãy thử chọn đáp án khác.
                            </div>
                        )}

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
